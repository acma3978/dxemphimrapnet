<?php defined('SYSPATH') or die('No direct script access.');class Controller_Frontend_Page extends Controller_Frontend {	public function action_index()	{		$page_id = $this->_input->filter_single('page_id', Light_Input::UINT);		$page_model = $this->_get_page_model();				if(empty($page_id) OR !$pageinfo = $page_model->get_page_by_id($page_id))		{			$this->redirect(				Light_Link::build('error', 'action=404', 'path=' . $this->request->uri())			);		}		// ambient		if(empty($pageinfo['active']))		{			$this->redirect('http://bitphim.net/'.$this->request->uri());						/*$this->redirect(				Light_Link::build('home', '', 'ref=page')			);*/		}		$pageinfo['pagetext'] = preg_replace_callback('#\[video\](.+?)\[\/video\]#i', create_function('$matches', '			return Player::render(strip_tags($matches[1]), 650, 400, stripos($matches[1], "autostart"));		'), $pageinfo['pagetext']);				// fetch recent		$recents = $page_model->get_pages(array(			'active' => $pageinfo['active'],		));		unset($recents[$page_id]);		foreach($recents as &$_page)		{			$_page['link'] = Light_Link::film('page', $_page);		}					$options = Light_Application::get('options');				$view_params = array(			'page_title' => "$pageinfo[title] - $pageinfo[title_ascii]",			'page_keywords' =>  $pageinfo['keywords']. ", $pageinfo[title], " . $options->web_keywords,			'page_description' => Light_Helper_Film::description(preg_replace('#\[video\].*?\[/video\]#i', '', $pageinfo['pagetext'])),						'pageinfo' 	=> $pageinfo,			'recents'	=> $recents,			'url_canonical' => Light_Link::film('page', $pageinfo, NULL, TRUE, TRUE),		);		$this->response_view('page', $view_params);			}		protected function _get_page_model()	{		return $this->get_model('Light_Model_Page');	}} 
<?php defined('SYSPATH') or die('No direct script access.');class Controller_Frontend_Home extends Controller_Frontend {	public function before(){		parent::before();	}	public function action_index(){        // 1: Phim lẻ or 2: Phim bộ        // Quốc gia        // Get số lượng        // Lượng chọn 1,2 khi Get        // select_field        //$this->_objectSel = array();        if(!$this->_caching OR !$phim_viet_nam = $this->_cache->get('phim_viet_nam')){            $phim_viet_nam = $this->_get_film(2, NULL, 5, FALSE, $this->_objectSel["option"] = array('order'=> array('film.last_update' => 'DESC','film.year' => 'DESC','film.views_day' => 'DESC'), 'conditions'=>array('country_id'=> 4)));            !$this->_caching OR $this->_cache->set('phim_viet_nam', $phim_viet_nam);        }        if(!$this->_caching OR !$phim_han_quoc = $this->_cache->get('phim_han_quoc')){            $phim_han_quoc = $this->_get_film(2, NULL, 5, FALSE, $this->_objectSel["option"] = array('order'=> array('film.last_update' => 'DESC','film.year' => 'DESC','film.views_day' => 'DESC'), 'conditions'=>array('country_id'=> 3)));            !$this->_caching OR $this->_cache->set('phim_han_quoc', $phim_han_quoc);        }        if(!$this->_caching OR !$phim_trung_quoc = $this->_cache->get('phim_trung_quoc')){            $phim_trung_quoc = $this->_get_film(2, NULL, 5, FALSE, $this->_objectSel["option"] = array('order'=> array('film.last_update' => 'DESC','film.year' => 'DESC','film.views_day' => 'DESC'), 'conditions'=>array('country_id'=> 2)));            !$this->_caching OR $this->_cache->set('phim_trung_quoc', $phim_trung_quoc);        }        if(!$this->_caching OR !$phim_my = $this->_cache->get('phim_my')){            $phim_my = $this->_get_film(0, NULL, 5, FALSE, $this->_objectSel["option"] = array('order'=> array('film.last_update' => 'DESC','film.year' => 'DESC','film.views_day' => 'DESC'), 'conditions'=>array('country_id'=> 1)));            !$this->_caching OR $this->_cache->set('phim_my', $phim_my);        }        if(!$this->_caching OR !$phim_hot = $this->_cache->get('phim_hot')){            $i = 1;            $count_phim_hot = $this->_get_film(0, NULL, 30, FALSE, $this->_objectSel["option"] = array('order'=>array('film.last_update_episode'=> 'DESC', 'film.year'=> 'DESC')),TRUE);            foreach ($count_phim_hot as $k => $item) {                if($i <= 4) {                    $phim_hot['top'][$i] = $item;                }elseif($i >= 4){                    $phim_hot['last'][$i] = $item;                }                $i++;            }            !$this->_caching OR $this->_cache->set('phim_hot', $phim_hot);        }//        if(!$this->_caching OR !$phim_hot = $this->_cache->get('phim_hot')){////            $phim_hot = $this->_get_film(0, NULL, 30, FALSE, $this->_objectSel["option"] = array('order'=>array('film.last_update_episode'=> 'DESC', 'film.year'=> 'DESC')),TRUE);//            !$this->_caching OR $this->_cache->set('phim_hot', $phim_hot);//        }		/*if(!$this->_caching OR !$phim_bo_moi = $this->_cache->get('phim_bo_moi'))		{			$phim_bo_moi = $this->_get_phim_bo_hay(0,8);			!$this->_caching OR $this->_cache->set('phim_bo_moi', $phim_bo_moi);		}		if(!$this->_caching OR !$phim_bo_full = $this->_cache->get('phim_bo_full'))		{			$phim_bo_full = $this->_get_phim_bo_hay(1,8);			!$this->_caching OR $this->_cache->set('phim_bo_full', $phim_bo_full);		}*/      /*  if(!$this->_caching OR !$phim_le_moi_cap_nhat = $this->_cache->get('phim_le_moi_cap_nhat'))        {            $phim_le_moi_cap_nhat = $this->_get_film(1, NULL, 8, FALSE, $this->_objectSel["option"] = array('order'=>array('film.last_update_episode'=> 'DESC', 'film.year'=> 'DESC')));            !$this->_caching OR $this->_cache->set('phim_le_moi_cap_nhat', $phim_le_moi_cap_nhat);        }        if(!$this->_caching OR !$phim_bo_moi_cap_nhat = $this->_cache->get('phim_bo_moi_cap_nhat'))        {            $phim_bo_moi_cap_nhat = $this->_get_film(2, NULL, 8, FALSE, $this->_objectSel["option"] = array('order'=>array('film.last_update_episode'=> 'DESC', 'film.year'=> 'DESC')));            !$this->_caching OR $this->_cache->set('phim_bo_moi_cap_nhat', $phim_bo_moi_cap_nhat);        }                if(!$this->_caching OR !$phim_moi_cap_nhat = $this->_cache->get('phim_moi_cap_nhat'))        {            $phim_moi_cap_nhat = $this->_get_film(0, NULL, 10, FALSE, $this->_objectSel["option"] = array('order'=>array('film.last_update_episode' => 'DESC', 'film.year'=> 'DESC')));            !$this->_caching OR $this->_cache->set('phim_moi_cap_nhat', $phim_moi_cap_nhat);        }*/		$view_params = array(            'phim_hot'             => $phim_hot,            /*'phim_moi_cap_nhat'    => $phim_moi_cap_nhat,            'phim_le_moi_cap_nhat' => $phim_le_moi_cap_nhat,            'phim_bo_moi_cap_nhat' => $phim_bo_moi_cap_nhat,*/            'phim_viet_nam'        => $phim_viet_nam,            'phim_my'              => $phim_my,            'phim_han_quoc'        => $phim_han_quoc,            'phim_trung_quoc'      => $phim_trung_quoc,		);		$this->response_view('home', $view_params);	}    /*protected function _get_phim_moi_cap_nhat($type = 0, $limit = 8, $tnum = FALSE, $select_fields)    {        $conditions = array(            'active' => 1,            'check_trailer' => 0,        );        if($type > 0)        {            $conditions['type'] = $type;        }        $fetch_options = array(            'order' => array('film.last_update_episode' => 'DESC','film.year' => 'DESC'),            'limit' => $limit        );        if(is_array($select_fields)){            $fetch_options['select_fields'] = $select_fields;        }elseif($select_fields == 'some_fields'){            $fetch_options['some_fields'] = TRUE;        }        $films = $this->_get_film_model()->get_films($conditions,$fetch_options);            foreach($films as &$film)            {                if(!is_array($select_fields)){                    $film = Light_Helper_Film::parse($film);                }else{                    $film = Light_Helper_Film::parse($film,array('s_addition'));                }            }                 return $films;                //return array_map('Light_Helper_Film::parse', $films);    }*/			/**	 * Lấy ra phim mới cập nhật (mới edit thông tin phim)	 * type 1: phim lẻ, type 2: phim bộ, 0: toàn bộ	*/	    /*protected function _get_phim_moi_sticker($type = 0, $limit = 8)    {        $conditions = array(            'options' => 'phim_moi_sticker',            'active' => 1,        );        if($type > 0)        {            $conditions['type'] = $type;        }        $films = $this->_get_film_model()->get_films($conditions, array(            'order' => array(                'film.last_update_episode' => 'DESC',                'film.year' => 'DESC',            ),            'limit' => $limit,        ));        foreach($films as &$film)        {            $film = Light_Helper_Film::parse($film);        }        return $films;        //return array_map('Light_Helper_Film::parse', $films);    }*/	/**	 * Get list phim chiếu rạp đang hot ở home	 * @return array	*/	/*protected function _get_phim_chieu_rap_hot($limit=8)	{		$films = $this->_get_film_model()->get_films(			array(				'options' => 'phim_chieu_rap_hot',				'active' => 1,			), 			array(				'order' => array(					'film.last_update' => 'DESC'				),                'limit' => $limit,			)		);		foreach($films as &$film)		{			$film = Light_Helper_Film::parse($film);		}		return $films;		//return array_map('Light_Helper_Film::parse', $films);	}*/		/**	 * Box phim hay đề cử	 * type: 0 - chưa hoàn thành	 * type: 1 - đã hoàn thành	*/	protected function _get_phim_bo_hay($type = 0, $limit = 8){		$films = $this->_get_film_model()->get_films(array(				'options' => $type ? 'phim_bo_full' : 'phim_bo_moi',				'active' => 1,			), array('order' => array('film.last_update' => 'DESC'),                'limit' => $limit,			)		);        //return $films;		return array_map('Light_Helper_Film::parse', $films);	}    /*protected function _get_country($type = 0,$country = NULL, $limit = 8, $select_fields = NULL){        $conditions = array(            'active'=>'1'        );        if($type > 0)        {            $conditions['type'] = $type;        }        if($country > 0){            $conditions['country_id'] = $country;        }        $fetch_options = array(            'order' => array('film.last_update' => 'DESC','film.year' => 'DESC','film.views_day' => 'DESC'),            'limit' => $limit        );        if(is_array($select_fields)){            $fetch_options['select_fields'] = $select_fields;        }elseif($select_fields == 'some_fields'){            $fetch_options['some_fields'] = TRUE;        }        $films = $this->_get_film_model()->get_films($conditions, $fetch_options);        foreach($films as &$film) {            if(!is_array($select_fields)){                $film = Light_Helper_Film::parse($film);            }else{                $film = Light_Helper_Film::parse($film,array('s_addition'));            }        }        return $films;        //return array_map('Light_Helper_Film::parse', $films);    }*/    } 
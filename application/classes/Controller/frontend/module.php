<?php defined('SYSPATH') or die('No direct script access.');class Controller_Frontend_Module extends Controller_Frontend {	public function action_picasa()	{		exit;		set_time_limit(60);				$films = DB::select()->from('film')			//->where('image_url', 'LIKE ', '%google%')			->where('film_id', '>', intval($this->request->query('next')))			->order_by('film_id')			->limit(10)		->execute()->as_array();		//$film = reset($films);		if( ! $films)		{			die('Xong');		}			foreach($films as $film)			{				$image_url = preg_replace('#s[\d]+/?#', '', $film['image_url']);				/*				$image_name = $film['title'] . ' ' . $film['title_o'] . ' ' . $film['year'];				echo $film['film_id'].' - '.$film['title'].'<br />';				$image_url = $film['image_url'];				echo $image_url.'<br />';				echo basename($image_url);			//if(strpos(basename($image_url), '.') !== FALSE)			//{				//image_url = str_replace(basename($image_url), '', $image_url);				$filename = $film['image'];				$config = Light_Config::get('config.film');				$data_dir = Light_Helper_File::get_data_dir();				$image_file = $data_dir . $config['image_path'] . $filename;				$image_value = $filename;				if( ! file_exists($image_file))				{					$image_value = Light_Helper_Film::leech_image($film['image_url2'], $image_name);				}				$image_url = Light_Helper_Film::put_image_to_picasa($image_value);				*/			if($image_url)			{				$this->_get_film_model()->update($film['film_id'], 'image_url', $image_url);			}			else			{				echo 'ko can';			}		}		echo '<script>		setTimeout(function(){			window.location = "?next='.$film['film_id'].'";			}, 100);		</script>';	}	public function action_x1()	{		exit;		$tags = DB::query(Database::SELECT, '				SELECT title_ascii				FROM c_tag AS film				WHERE title NOT LIKE \'%2\'					AND title_ascii LIKE \'%2\'			')->execute()->as_array('title_ascii');		foreach(array_keys($tags) AS $title)		{			$items = DB::query(Database::SELECT, '				SELECT film.title, film.film_id , tags, tags_ascii				FROM c_film AS film				WHERE tags_ascii LIKE \'%'.$title.'%\'			')->execute()->as_array();			foreach($items as &$item)			{				$tags_ascii = explode(',', $item['tags_ascii']);				$tags = explode(',', $item['tags']);				$key = array_search($title, $tags_ascii);				unset($tags[$key]);				unset($tags_ascii[$key]);				$item['tags'] = implode(',', $tags);				$item['tags_ascii'] = implode(',', $tags_ascii);				$this->_get_film_model()->update($item['film_id'], 'tags', $item['tags']);				$this->_get_film_model()->update($item['film_id'], 'tags_ascii', $item['tags_ascii']);			}		}	}}